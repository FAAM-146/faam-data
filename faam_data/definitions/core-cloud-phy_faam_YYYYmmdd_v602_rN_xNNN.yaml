# Definition file for FAAM core cloud data
#
# Definition version: 20240201
# Creates version: 602
# Example filename: core-cloud-phy_faam_20220731_v602_r0_c308.nc
#
meta:
  file_pattern: >-
    core-cloud-phy_faam_[0-9]{8}_v001_r[0-9]+_[c-z][0-9]{3}_cip100-1.nc
  short_name: core_cloud
  long_name: FAAM core cloud data
  description: >-
    This dataset contains processed FAAM core cloud data. This is from aerosol
    and cloud instruments mounted under the wing and operated by the PI rack.
  references:
    - ['FAAM instrument documentation', 'https://www.faam.ac.uk/sphinx/instruments/']

# Global attributes
# ------------------------------------------------------------------------------
attributes:
  Conventions: '<str: derived_from_file>' #CF-1.9 ACDD-1.3
  title: '<str: derived_from_file>'
  summary: '<str: derived_from_file>'
  references: '<str: derived_from_file>'
  comment: '<str: derived_from_file optional>'
  history: '<str: derived_from_file>'
  revision_date: '<str: derived_from_file>'  #'datetime.date'
  revision_number: '<int: derived_from_file>'
  revision_comment: '<str: derived_from_file optional>'

  # data creator and publisher
  creator_name: '<str: derived_from_file>'
  creator_institution: FAAM Airborne Laboratory
  creator_address:  Building 146, Cranfield University, College Road, Cranfield, Bedford. MK43 0AL. UK.
  creator_email: '<str: derived_from_file>'
  creator_url: '<str: derived_from_file optional>'
  creator_type: '<str: derived_from_file>'
  date_created: '<str: derived_from_file>'  #'datetime.datetime'
  publisher_institution: CEDA
  publisher_type: institution
  publisher_email: support@ceda.ac.uk
  publisher_url: https://www.ceda.ac.uk

  # data source information
  source: '<str: derived_from_file>'
  institution: FAAM Airborne Laboratory
  address: >-
    Building 146, Cranfield University, College Road,
    Cranfield, Bedford. MK43 0AL. UK.
  platform: FAAM BAe-146-301 Atmospheric Research Aircraft
  platform_type: aircraft
  deployment_mode: '<str: derived_from_file optional,regex=air>'
  naming_authority: uk.ac.faam
  id: '<str: derived_from_file>'
  uuid: '<str: derived_from_file>'

  # project information
  project: '<str: derived_from_file optional>'
  project_name: '<str: derived_from_file optional>'
  project_acronym: '<str: derived_from_file optional>'
  project_principal_investigator: '<str: derived_from_file optional>'
  project_principal_investigator_email: '<str: derived_from_file optional>'
  project_principal_investigator_url: '<str: derived_from_file optional>'

  # processor information
  processing_software_commit: '<str: derived_from_file optional>'
  processing_software_doi: '<str: derived_from_file optional>'
  processing_software_url:  '<str: derived_from_file optional>'
  processing_software_version: '<str: derived_from_file>'

  # data information
  date: '<str: derived_from_file>'  #'datetime.date'
  flight_date: '<str: derived_from_file>'  #'datetime.date'
  flight_number: '<str: derived_from_file>'
  time_coverage_duration: '<str: derived_from_file>'  #'datetime.timedelta'
  time_coverage_start: '<str: derived_from_file>'  #'datetime.datetime'
  time_coverage_end: '<str: derived_from_file>'  #'datetime.datetime'
  geospatial_bounds: '<str: derived_from_file>'
  geospatial_bounds_crs: '<str: derived_from_file>'
  geospatial_lat_max: '<float32: derived_from_file>'
  geospatial_lat_min: '<float32: derived_from_file>'
  geospatial_lat_units: '<str: derived_from_file>'
  geospatial_lon_max: '<float32: derived_from_file>'
  geospatial_lon_min: '<float32: derived_from_file>'
  geospatial_lon_units: '<str: derived_from_file>'
  geospatial_vertical_max: '<float32: derived_from_file>'
  geospatial_vertical_min: '<float32: derived_from_file>'
  geospatial_vertical_units: '<str: derived_from_file>'
  geospatial_vertical_positive: '<str: derived_from_file>'

  # Usage and vocab information
  keywords: >-
    AEROSOL SIZE DISTRIBUTION, CLOUD DROPLET DISTRIBUTION
  keywords_vocabulary: 'Global Change Master Directory (GCMD)'
  metadata_link: '<str: derived_from_file>'
  standard_name_vocabulary: '<str: derived_from_file>'
  license: >-
    UK Government Open Licence agreement -
    http://www.nationalarchives.gov.uk/doc/open-government-licence
  acknowledgement: >-
    Airborne data was obtained using the BAe-146-301 Atmospheric Research
    Aircraft [ARA] flown by Airtask Ltd and managed by FAAM Airborne
    Laboratory, jointly operated by UKRI and the University of Leeds

dimensions:     # Add in dimensions for all/most eventualities
  - name: Time
    size: null
  - name: sps32
    size: 32
  - name: sps25
    size: 25
  - name: sps20
    size: 20
  - name: sps10
    size: 10
  - name: sps05
    size: 5

variables:
  - meta:
      name: Time
      datatype: <int32>
      required: false
    dimensions: ['Time']
    attributes:
      long_name: Time of measurement
      standard_name: time
      calendar: gregorian
      coverage_content_type: coordinate
      source: '<str: derived_from_file>'    # core filename and variable name
      frequency: 32
      units: '<str: derived_from_file>'
      _FillValue: -9999


# ------------------------------------------------------------------------------
groups:
  - meta:
      name: platform
      description: Data from aircraft that has been used to process probe data

    attributes:
      comment: '<str: derived_from_file optional>'

    dimensions: []

    variables:
      - meta:
          name: altitude
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Platform altitude
          standard_name: altitude
          coverage_content_type: physicalMeasurement
          source: '<str: derived_from_file>'    # core filename and variable name
          frequency: 32
          units: '<str: derived_from_file>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          ancillary_variables: altitude_flag
          axis: Z
          positive: up
          _FillValue: -9999.

      - meta:
          name: altitude_flag
          datatype: <byte>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Data quality flag for altitude
          valid_range:
            - '<byte: derived_from_file>'
            - '<byte: derived_from_file>'
          flag_masks: '<Array[byte]: derived_from_file>'
          flag_meanings: '<str: derived_from_file>'
          coverage_content_type: qualityInformation
          source: '<str: derived_from_file>'
          frequency: 32
          units: '1'
          _FillValue: 0

      - meta:
          name: latitude
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Platform latitude
          standard_name: latitude
          coverage_content_type: physicalMeasurement
          source: '<str: derived_from_file>'
          frequency: 32
          units: '<str: derived_from_file>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          ancillary_variables: latitude_flag
          axis: Y
          _FillValue: -9999.

      - meta:
          name: latitude_flag
          datatype: <byte>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Data quality flag for latitude
          valid_range:
            - '<byte: derived_from_file>'
            - '<byte: derived_from_file>'
          flag_masks: '<Array[byte]: derived_from_file>'
          flag_meanings: '<str: derived_from_file>'
          coverage_content_type: qualityInformation
          source: '<str: derived_from_file>'
          frequency: 32
          units: '1'
          _FillValue: 0

      - meta:
          name: longitude
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Platform longitude
          standard_name: longitude
          coverage_content_type: physicalMeasurement
          source: '<str: derived_from_file>'
          frequency: 32
          units: '<str: derived_from_file>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          ancillary_variables: longitude_flag
          axis: X
          _FillValue: -9999.

      - meta:
          name: longitude_flag
          datatype: <byte>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Data quality flag for longitude
          valid_range:
            - '<byte: derived_from_file>'
            - '<byte: derived_from_file>'
          flag_masks: '<Array[byte]: derived_from_file>'
          flag_meanings: '<str: derived_from_file>'
          coverage_content_type: qualityInformation
          source: '<str: derived_from_file>'
          frequency: 32
          units: '1'
          _FillValue: 0

      - meta:
          name: tas
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Platform true air speed
          standard_name: platform_speed_wrt_air
          coverage_content_type: physicalMeasurement
          source: '<str: derived_from_file>'
          frequency: 32
          units: '<str: derived_from_file>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          ancillary_variables: tas_flag
          _FillValue: -9999.

      - meta:
          name: tas_flag
          datatype: <byte>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Data quality flag for tas
          valid_range:
            - '<byte: derived_from_file>'
            - '<byte: derived_from_file>'
          flag_masks: '<Array[byte]: derived_from_file>'
          flag_meanings: '<str: derived_from_file>'
          coverage_content_type: qualityInformation
          source: '<str: derived_from_file>'
          frequency: 32
          units: '1'
          _FillValue: 0

      - meta:
          name: pressure
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: '<str: derived_from_file>'
          standard_name: air_pressure
          coverage_content_type: physicalMeasurement
          source: '<str: derived_from_file>'
          frequency: 32
          units: '<str: derived_from_file>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          ancillary_variables: pressure_flag
          _FillValue: -9999.

      - meta:
          name: pressure_flag
          datatype: <byte>
          required: false
        dimensions:
          - Time
          - sps32
        attributes:
          long_name: Data quality flag for pressure
          valid_range:
            - '<byte: derived_from_file>'
            - '<byte: derived_from_file>'
          flag_masks: '<Array[byte]: derived_from_file>'
          flag_meanings: '<str: derived_from_file>'
          coverage_content_type: qualityInformation
          source: '<str: derived_from_file>'
          frequency: 32
          units: '1'
          _FillValue: 0


# ------------------------------------------------------------------------------
  - meta:
      name: pcasp-1
      description: Data from PCASP-1
      required: false

    attributes:
      summary: '<str: derived_from_file>'
      comment: '<str: derived_from_file optional>'

      # instrument information
      instrument: PCASP-1
      instrument_manufacturer: Particle Metrics Inc./Droplet Measurement Technologies Inc.
      instrument_model: Passive Cavity Aerosol Spectrometer Probe 100X with SPP200 electronics (PCASP-100X (SPP200))
      instrument_serial: '17884-0190-04'
      instrument_location: '<str: derived_from_file>'
      instrument_description: '<str: derived_from_file>'
      references: >-
        Rosenberg et al., 2012, (https://doi.org/10.5194/amt-5-1147-2012).
        Cai et al., 2013, (https://doi.org/10.5194/amt-6-2349-2013)
      instrument_software: '<str: derived_from_file>'
      instrument_software_version: '<str: derived_from_file>'

      # processing algorithm information
      processing_software_version: '<str: derived_from_file optional>'
      processing_software_url: '<str: derived_from_file optional>'
      processing_software_doi: '<str: derived_from_file optional>'
      source: '<str: derived_from_file optional>'                       # list of raw data files

    dimensions:
      - name: bin
      - size: 30

    variables:
      - meta:
          name: bin_centre
          datatype: <float32>
          required: true
        dimensions:
          - bin
        attributes:
          long_name: Nominal bin centre diameter
          standard_name: diameter_of_ambient_aerosol_particles
          coverage_content_type: physicalMeasurement
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: '<float32: derived_from_file optional>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: bin_width
          datatype: <float32>
          required: true
        dimensions:
          - bin
        attributes:
          long_name: Nominal bin width
          coverage_content_type: physicalMeasurement
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: '<float32: derived_from_file optional>'
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: counts
          datatype: <uint32>
          required: true
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
          - bin
        attributes:
          long_name: Raw particle counts in each size bin and sample time
          coverage_content_type: physicalMeasurement
          frequency: '<int: derived_from_file>'
          units: '1'
          valid_min: '<uint32: derived_from_file optional>'
          actual_range:
            - '<uint32: derived_from_file>'
            - '<uint32: derived_from_file>'
          coordinates: latitude longitude altitude
          ancillary_variables: pcasp_flag
          _FillValue: 65535

      - meta:
          name: concentration
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
          - bin
        attributes:
          long_name: Size-resolved aerosol number concentration
          standard_name: number_size_distribution_of_aerosol_particles_in_air
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: physicalMeasurement
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          coordinates: latitude longitude altitude
          ancillary_variables: concentration_error pcasp_flag
          _FillValue: -9999.

      - meta:
          name: concentration_error
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
          - bin
        attributes:
          long_name: Error in size-resolved aerosol number concentration, 1-sigma uncertainty
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: auxiliaryInformation
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: total_concentration
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
        attributes:
          long_name: Total particle number concentration over bin_range
          standard_name: number_concentration_of_ambient_aerosol_particles_in_air
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: physicalMeasurement
          bin_range: '<Array[int]: derived_from_file>'
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          coordinates: latitude longitude altitude
          ancillary_variables: total_concentration_error pcasp_flag
          _FillValue: -9999.

      - meta:
          name: total_concentration_error
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
        attributes:
          long_name: Error in total particle number concentration over bin_range, 1-sigma uncertainty
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: auxiliaryInformation
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: concentration_corrected
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
          - bin
        attributes:
          long_name: Size-resolved aerosol number concentration - corrected for nonisokinetic sampling
          standard_name: number_size_distribution_of_aerosol_particles_in_air
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: physicalMeasurement
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          coordinates: latitude longitude altitude
          ancillary_variables: concentration_corrected_error pcasp_flag
          _FillValue: -9999.

      - meta:
          name: concentration_corrected_error
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
          - bin
        attributes:
          long_name: Error in size-resolved aerosol number concentration - corrected for nonisokinetic sampling, 1-sigma uncertainty
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: auxiliaryInformation
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: total_concentration_corrected
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
        attributes:
          long_name: Total particle number concentration over bin_range - corrected for nonisokinetic sampling
          standard_name: number_concentration_of_ambient_aerosol_particles_in_air
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: physicalMeasurement
          bin_range: '<Array[int]: derived_from_file>'
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          coordinates: latitude longitude altitude
          ancillary_variables: total_concentration_corrected_error pcasp_flag
          _FillValue: -9999.

      - meta:
          name: total_concentration_corrected_error
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
        attributes:
          long_name: Error in total particle number concentration over bin_range - corrected for nonisokinetic sampling, 1-sigma uncertainty
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          coverage_content_type: auxiliaryInformation
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: sample_flow
          datatype: <float32>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
        attributes:
          long_name: Volumetric sample flow
          comment: '<str: derived_from_file optional>'
          references: '<str: derived_from_file optional>'
          calibrated: '<str: derived_from_file optional>'
          calibration_date: '<str: derived_from_file optional>'
          calibration_information: '<str: derived_from_file optional>'
          coverage_content_type: physicalMeasurement
          frequency: '<int: derived_from_file>'
          units: '<str: derived_from_file>'
          valid_min: 0.
          actual_range:
            - '<float32: derived_from_file>'
            - '<float32: derived_from_file>'
          _FillValue: -9999.

      - meta:
          name: pcasp_flag
          datatype: <byte>
          required: false
        dimensions:
          - Time
          - '<str: derived_from_file optional,regex=sps>'
        attributes:
          long_name: Flag for all PCASP derived parameters
          standard_name: status_flag
          comment: '<str: derived_from_file optional>'
          coverage_content_type: qualityInformation
          flag_masks: '<Array[byte]: derived_from_file>'
          flag_meanings: '<str: derived_from_file>'
          frequency: '<int: derived_from_file>'
          units: '1'
          valid_min: 0.
          valid_range:
            - 1b
            - '<byte: derived_from_file>'
          _FillValue: 0b

