# Definition file for FAAM CIP15-1
# Use with SPIF vocal project to create/check netCDF files
# see;
#    https://github.com/FAAM-146/spif
#
# Creates version: 1.0
# Example filename: core-cloud-phy_faam_20230614_v100_r0_c339_cip15-1.nc
#
meta:
  file_pattern: >-
    core-cloud-phy_faam_[0-9]{8}_v100_r[0-9]+_[c-z][0-9]{3}_cip15-1.nc
  short_name: 'spif_cip15-1'
  canonical_name: 'Decoded image data from the CIP15-1'
  description: >-
    This dataset contains decoded raw image data from the DMT Cloud Imaging
    Probe. Data is stored using the SPIF standard file structure. Higher level
    data products, derived from the image data, may also be in this file.
  references:
  - ['FAAM instrument documentation', 'https://www.faam.ac.uk/sphinx/instruments/']
  - ['SPIF standard', 'https://github.com/FAAM-146/spif']

# ------------------------------------------------------------------------------
attributes:
  title: '<str: derived_from_file>'
  summary: '<str: derived_from_file>'
  references: '<str: derived_from_file>'
  comment: '<str: derived_from_file optional>'
  history: '<str: derived_from_file>'
  revision_date: '<datetime.date: derived_from_file>'
  revision_number: '<int: derived_from_file>'
  revision_comment: '<str: derived_from_file optional>'

  # data creator and publisher
  creator_name: '<str: derived_from_file>'
  creator_institution: '<str: derived_from_file>'
  creator_address:  '<str: derived_from_file>'
  creator_email: '<str: derived_from_file>'
  creator_url: '<str: derived_from_file optional>'
  creator_type: '<str: derived_from_file>'
  date_created: '<datetime.datetime: derived_from_file>'
  publisher_institution: CEDA
  publisher_type: institution
  publisher_email: support@ceda.ac.uk
  publisher_url: https://www.ceda.ac.uk

  # data source information
  source: CIP15-1
  instrument: CIP15   #### this is the name of the instrument group
  institution: FAAM Airborne Laboratory
  address: >-
    Building 146, Cranfield University, College Road,
    Cranfield, Bedford. MK43 0AL. UK.
  platform: FAAM BAe-146-301 Atmospheric Research Aircraft
  platform_type: aircraft
  deployment_mode: '<str: derived_from_file optional,regex=air>'
  naming_authority: uk.ac.faam
  id: '<str: derived_from_file>'
  uuid: '<uuid: derived_from_file>'

  # project information
  project: '<str: derived_from_file optional>'
  project_name: '<str: derived_from_file optional>'
  project_acronym: '<str: derived_from_file optional>'
  project_principal_investigator: '<str: derived_from_file optional>'
  project_principal_investigator_email: '<str: derived_from_file optional>'
  project_principal_investigator_url: '<str: derived_from_file optional>'

  # processor information
  processing_software_commit: '<str: derived_from_file optional>'
  processing_software_doi: '<str: derived_from_file optional>'
  processing_software_url:  '<str: derived_from_file optional>'
  processing_software_version: '<str: derived_from_file>'

  # data information
  date: '<datetime.date: derived_from_file>'
  flight_date: '<datetime.date: derived_from_file>'
  flight_number: '<str: derived_from_file>'
  time_coverage_duration: '<datetime.timedelta: derived_from_file>'
  time_coverage_start: '<datetime.datetime: derived_from_file>'
  time_coverage_end: '<datetime.datetime: derived_from_file>'
  geospatial_bounds: '<str: derived_from_file>'
  geospatial_bounds_crs: '<str: derived_from_file>'
  geospatial_lat_max: '<float: derived_from_file>'
  geospatial_lat_min: '<float: derived_from_file>'
  geospatial_lat_units: '<str: derived_from_file>'
  geospatial_lon_max: '<float: derived_from_file>'
  geospatial_lon_min: '<float: derived_from_file>'
  geospatial_lon_units: '<str: derived_from_file>'
  geospatial_vertical_max: '<float: derived_from_file>'
  geospatial_vertical_min: '<float: derived_from_file>'
  geospatial_vertical_units: '<str: derived_from_file>'
  geospatial_vertical_positive: '<str: derived_from_file>'

  # Usage and vocab information
  keywords: >-
    EARTH SCIENCE > ATMOSPHERE > CLOUDS >
    CLOUD MICROPHYSICS > CLOUD DROPLET DISTRIBUTION
  keywords_vocabulary: 'Global Change Master Directory (GCMD)'
  metadata_link: '<str: derived_from_file>'
  standard_name_vocabulary: '<str: derived_from_file>'
  license: >-
    UK Government Open Licence agreement -
    http://www.nationalarchives.gov.uk/doc/open-government-licence'
  acknowledgement: >-
    Airborne data was obtained using the BAe-146-301 Atmospheric Research
    Aircraft [ARA] flown by Airtask Ltd and managed by FAAM Airborne
    Laboratory, jointly operated by UKRI and the University of Leeds.

variables: []
dimensions: []

# ------------------------------------------------------------------------------
groups:
  # instrument group
  - meta:
    name: CIP15
    description: Instrument group of raw and processed data for this instrument.

  attributes:
    # instrument information
    instrument_name: CIP15-1
    instrument_long_name: Cloud Imaging Probe, 15 um resolution.
    instrument_description: >-
      Droplet Measurement Technologies Inc. Cloud Imaging Probe,
      15 micron resolution with Grayscale and Korolev anti-shatter
      tips (CIP-15 GS)
    instrument_location: '<str: derived_from_file>'
    instrument_orientation: '<str: derived_from_file>'
    instrument_manufacturer: Droplet Measurement Technologies
    instrument_model: CIP15
    instrument_serial_number: '0302-002'
    instrument_software: '<str: derived_from_file optional>'
    instrument_software_version: '<str: derived_from_file optional>'
    instrument_fimware: '<str: derived_from_file optional>'
    references: >    ## Or maybe this should be FAAM instr page thing
      https://www.dropletmeasurement.com/manual/
      operator-manual-cloud-imaging-probe-cip/
    raw_filenames: '<str: derived_from_file optional>'

  # instrument group dimensions
  dimensions:
    - name: array_dimensions
      size: 2
    - name: pixel_colors
      size: 3

  # instrument group mandatory variables
  variables:
  - meta:
      name: color_level
      datatype: <float32>
      required: true
    dimensions: ['pixel_colors']
    attributes:
      long_name: Lower bound of obscuration/grayscale/color level
      comment: >-
        Obscuration/grayscale/color level corresponding to each value of
        pixel_colors. For example, a grayscale OAP may have lower-bound shadow
        levels of [0, 0.25, 0.5, 0.75].
  - meta:
      name: array_size
      datatype: <int32>
      required: true
    dimensions: ['array_dimensions']
    attributes:
      long_name: Number of pixels in detector
  - meta:
      name: image_size
      datatype: <int32>
      required: true
    dimensions: ['array_dimensions']
    attributes:
      long_name: Number of pixels across an image
      comment: If variable size images are given then is _FillValue.
  - meta:
      name: resolution
      datatype: <float32>
      required: true
    dimensions: ['array_dimensions']
    attributes:
      long_name: Pixel resolution
      units: '<str: derived_from_file>'
  - meta:
      name: wavelength
      datatype: <float32>
      required: true
    dimensions: []
    attributes:
      long_name: Wavelength of laser used for imaging particles
      units: '<str: derived_from_file>'
  - meta:
      name: pathlength
      datatype: <float32>
      required: true
    dimensions: []
    attributes:
      long_name: Optical path length of imaging region
      comment: For OAPs the pathlength will be arm separation distance.
      units: '<str: derived_from_file>'
  # instrument group optional variables
  - meta:
      name: color_value
      datatype: <uint8>
      required: false
    dimensions: ['pixel_colors']
    attributes:
      long_name: Byte values of image associated with each color_level value
  - meta:
      name: resolution_error
      datatype: <float32>
      required: false
    dimensions: ['array_dimensions']
    attributes:
      long_name: Uncertainty of pixel resolution
      units: '<str: derived_from_file>'

# -----------------------------------------------------------------------------
  groups:
    # instrument/core group
    - meta:
      name: images
      description: Decompressed raw image data

    attributes: {}

    # instrument/images group dimensions. Both are UNLIMITED
    dimensions:
      - name: image_num
        size: null
      - name: pixel
        size: null

    # instrument/images group mandatory variables
    - meta:
        name: timestamp
        datatype: <uint64>
        required: true
      dimensions: ['image_num']
      attributes:
        long_name: Image arrival time
        standard_name: time
        units: '<str: derived_from_file>'
    - meta:
        name: image
        datatype: <uint8>
        required: true
      dimensions: ['pixel']
      attributes:
        long_name: 1-dimensional array of images
    - meta:
        name: startpixel
        datatype: <uint8>
        required: true
      dimensions: ['image_num']
      attributes:
        long_name: Array index for the first pixel of each image in image
    - meta:
        name: width
        datatype: <uint8>
        required: true
      dimensions: ['image_num']
      attributes:
        long_name: Number of pixels across image
    - meta:
        name: height
        datatype: <uint8>
        required: true
      dimensions: ['image_num']
      attributes:
        long_name: Number of slices/lines across image
    - meta:
        name: overload
        datatype: <byte>
        required: true
      dimensions: ['image_num']
      attributes:
        long_name: Overload flag for each image
    # instrument/images group optional variables
    - meta:
        name: timestamp_flag
        datatype: <byte>
        required: false
      dimensions: ['image_num']
      attributes:
        long_name: Surety in determination of image arrival timestamp
        flag_values: '<str: derived_from_file>'   ### Is this a string??
        flag_meanings: '<str: derived_from_file>'


# -----------------------------------------------------------------------------
  groups:
    # instrument/particles group
    - meta:
      name: particles
      description: Raw particle data

    attributes: {}

    # instrument/particles group dimensions. Both are UNLIMITED
    dimensions:
      - name: particle_num
        size: null
      - name: pixel
        size: null

    # instrument/particles group mandatory variables
    - meta:
        name: timestamp
        datatype: <uint64>
        required: true
      dimensions: ['particle_num']
      attributes:
        long_name: Paricle arrival time
        standard_name: time
        units: '<str: derived_from_file>'
    - meta:
        name: particle
        datatype: <uint8>
        required: true
      dimensions: ['pixel']
      attributes:
        long_name: 1-dimensional array of particles
    - meta:
        name: startpixel
        datatype: <uint8>
        required: true
      dimensions: ['particle_num']
      attributes:
        long_name: Array index for the first pixel of each particle in particle
    - meta:
        name: width
        datatype: <uint8>
        required: true
      dimensions: ['particle_num']
      attributes:
        long_name: Number of pixels across particle
    - meta:
        name: height
        datatype: <uint8>
        required: true
      dimensions: ['particle_num']
      attributes:
        long_name: Number of slices/lines across particle
    - meta:
        name: overload
        datatype: <byte>
        required: true
      dimensions: ['particle_num']
      attributes:
        long_name: Overload flag for each particle
    # instrument/particles group optional variables
    - meta:
        name: timestamp_flag
        datatype: <byte>
        required: false
      dimensions: ['particle_num']
      attributes:
        long_name: Surety in determination of particle arrival timestamp
        flag_values: '<str: derived_from_file>'   ### Is this a string??
        flag_meanings: '<str: derived_from_file>'






    # instrument/level-0 group
    - meta:
      name: level-0
      description: Raw particle image data

    attributes: {}

